## 模板方法

封装算法

**模板算法定义了一个算法的步骤，并允许子类为一个或者多个步骤提供实现**

从两个具有相似或者内容的类中提取公共部分，作为超类中的方法。将具有相似点的方法泛化，定义成在抽象类中统一的抽象接口，其实现在子类中具体实现。

将重复逻辑放入一起，使的代码的复用最大化。重复的地方只存在于一个地方，更容易修改。

提供了框架，超类只专注算法本身，子类提供完整实现。

### 模板方法模式

#### 定义

**模板方法模式在一个方法中定义一个算法的骨架，而将这些步骤延迟到子类中。是的子类在可以不改变算法结构的情况下重新定义算法中的某些步骤**

<img src="E:\研究生学习\Typora图片\1575551685069.png" alt="1575551685069" style="zoom:80%;" />

<img src="E:\研究生学习\Typora图片\1575551962779.png" alt="1575551962779" style="zoom: 80%;" />

#### 模板方法的更复杂实现：hook钩子

<img src="E:\研究生学习\Typora图片\1575552036600.png" alt="1575552036600" style="zoom:80%;" />

* **钩子**是一种被声明在抽象类中的方法，但是只有空的或者默认的实现，钩子的存在，可以让子类有能力对算法的不同点进行挂钩。要不要挂钩由子类具体决定。

<img src="E:\研究生学习\Typora图片\1575552339137.png" alt="1575552339137" style="zoom: 67%;" />

某个方法在超类中只会返回true，可以在子类中覆盖这个方法，加上自己的逻辑，依赖不同的场景返回true或者false，再决定执不执行钩子判断条件的方法。

* 钩子的另一种用法是让有机会对模板中某些即将发生或者刚刚发生的步骤做出反应。
* 算法的部分是可选的使用钩子



### OO原则：好莱坞原则

别调用（打电话）给我们，我们会调用（打电话给）你。

* 好莱坞原则给我们一种防止“依赖腐败”（底层组件依赖高层，高层依赖底层，各种组件依赖）的方法。允许底层组件将自己挂钩到系统上，高层组件觉得什么时候和怎样是使用这些底层组件。

<img src="E:\研究生学习\Typora图片\1575552893926.png" alt="1575552893926" style="zoom:80%;" />

#### 好莱坞原则与模板方法

<img src="E:\研究生学习\Typora图片\1575552969914.png" alt="1575552969914" style="zoom:80%;" />

模板方法中的子类值提供一些细节。高层组件控制整个算法和步骤，只用在需要子类实现某个方法时，才调用子类。

#### 好莱坞原则与依赖倒置原则

* 依赖倒置原则是多使用抽象，而好莱坞原则是创建框架或者组件上的一种技巧，好让底层组件被挂钩进计算中，而且不会让高层组件依赖底层组件。
* 目标都是解耦，依赖倒置更注重避免依赖。
* 好莱坞原则允许底层结构互相操作，防止其他类太过依赖他们，避免高层组件与底层组件有明显的环状依赖。

### 模板方法与策略

* **策略**：定义了一个算法家族，并让这些算法可以互换。因为每个算法被封装，客户可以轻易的使用不同的算法。 **组合方式让客户选择算法实现，更有弹性，可以在运行时动态改变他们的算法**
* **模板**：定义一个算法大纲，子类定义其中的步骤。可以有冉的实现细节，但是算法的结构依然保持不变。**对算法有更多控制权，而且不会重复代码**。依赖超类中的方法实现灵活性更强。
* 工厂方法是模板方法的一个特殊版本